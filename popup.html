<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="shell">
    <nav class="nav-container">
      <div class="tabs">
        <button class="tab-btn active" data-target="marketView">Mercado</button>
        <button class="tab-btn" data-target="calculatorsView">Calculadoras</button>
        <button class="tab-btn" data-target="settingsView">Configuraci√≥n</button>
      </div>
    </nav>

    <!-- Pesta√±a 1: Mercado (Indicadores + Salud Financiera) -->
    <div id="marketView" class="view-content">
      <div class="section">
        <div class="section-header">
          <div>
            <h3>Indicadores Banxico</h3>
            <p id="lastUpdated" class="muted" style="margin:2px 0">Actualizado: ‚Äî</p>
          </div>
          <button id="refresh" class="icon-btn" title="Actualizar datos">üîÑ</button>
        </div>
        <div id="warning" class="warn">
          Falta tu token SIE. <a href="onboarding.html" class="link" target="_blank">Config√∫ralo aqu√≠</a>.
        </div>

        <div id="indicatorCards" class="indicator-cards">
          <p class="muted" style="text-align:center">Cargando indicadores...</p>
        </div>
      </div>

      <!-- Widget de Salud Financiera -->
      <div class="section">
        <div class="section-header">
          <h3>Salud Financiera (Tasa Real)</h3>
          <span id="realRateLabel" class="badge">--</span>
        </div>

        <div class="real-rate-monitor">
          <div class="label-container">
            <span id="inflLabel" class="label-item red">Inflaci√≥n: --</span>
            <span id="targetLabel" class="label-item green">Tasa Objetivo: --</span>
          </div>
          <div class="real-rate-bar-container">
            <div id="realRateInflationBar" class="bar-segment inflation-bar"></div>
            <div id="realRateProfitBar" class="bar-segment profit-bar"></div>
          </div>
          <div id="realRateDescription" class="muted">
            Calculando rendimiento real...
          </div>
        </div>
      </div>

      <p class="muted" style="text-align: center; margin-top: 8px;">
        Fuente: SIE Banxico &middot; <a href="https://alasha.biz" target="_blank" class="link">alasha.biz</a>
      </p>
    </div>

    <!-- Pesta√±a 2: Calculadoras (UDIs + Fiscal) -->
    <div id="calculatorsView" class="view-content" style="display:none">
      <!-- Calculadora de UDIs -->
      <div class="section">
        <div class="section-header">
          <h3>Calculadora de UDIs</h3>
          <span id="calcModeLabel" class="muted">UDIs ‚Üí Pesos</span>
        </div>

        <div class="calc-grid">
          <div class="calc-field">
            <input type="number" id="calcAmount" class="calc-input" placeholder="Monto a convertir" step="0.01">
          </div>
          <div class="swap-btn-container">
            <button id="swapMode" class="icon-btn" title="Intercambiar modo (Pesos/UDIs)"
              style="font-size: 20px;">‚áÖ</button>
          </div>
        </div>

        <div id="calcResult" class="compact-result placeholder">
          El resultado aparecer√° aqu√≠
        </div>
        <div id="calcDate" class="muted" style="text-align:center; margin-top:12px; font-size: 11px;"></div>
      </div>

      <div class="section">
        <div class="section-header">
          <h3>Actualizaci√≥n Fiscal (INPC)</h3>
        </div>

        <div class="calc-field" style="margin-bottom: 20px;">
          <label class="muted">Monto Original</label>
          <input type="number" id="fiscalAmount" class="calc-input" placeholder="0.00" step="0.01">
        </div>

        <div class="calc-grid" style="align-items: flex-start;">
          <div class="calc-field">
            <label class="muted">Mes Inicial</label>
            <input type="month" id="fiscalInitialDate" class="calc-input">
          </div>
          <div class="calc-field">
            <label class="muted">Mes Final</label>
            <input type="month" id="fiscalFinalDate" class="calc-input">
          </div>
        </div>

        <button id="calculateFiscal" class="btn" style="width: 100%; margin-top: 10px; padding: 12px;">Calcular
          Actualizaci√≥n</button>

        <div id="fiscalResultContainer" class="fiscal-results" style="display: none;">
          <div class="result-item technical">
            <label class="muted">Factor</label>
            <div id="fiscalFactor">‚Äî</div>
          </div>
          <div class="result-item highlight">
            <label>Actualizado</label>
            <div id="fiscalUpdatedAmount">‚Äî</div>
          </div>
        </div>
      </div>
      <p class="caption">Basado en Serie SP1 (INPC) &middot; Banxico</p>
    </div>

    <!-- Pesta√±a 3: Configuraci√≥n -->
    <div id="settingsView" class="view-content" style="display:none">
      <div class="section">
        <div class="section-header">
          <h3>Ajustes R√°pidos</h3>
        </div>
        <p class="muted" style="margin-bottom: 24px;">Configura el comportamiento de la extensi√≥n y tu acceso al SIE
          Banxico.</p>

        <button id="openAdvancedSettings" class="btn btn-hero" style="width: 100%; padding: 14px;">
          Configuraci√≥n Avanzada
        </button>
      </div>
    </div>

    <!-- Vista de Historial (View Switcher) -->
    <div id="historicalView" class="view-content" style="display:none">
      <div class="section">
        <div class="view-header">
          <button id="backToMain" class="icon-btn back-btn" title="Volver">‚Üê</button>
          <h3 id="historicalTitle">Historial</h3>
        </div>

        <div class="calc-grid" style="align-items: flex-end; margin-top: 16px;">
          <div class="calc-field">
            <label class="muted">Desde</label>
            <input type="date" id="historicalStartDate" class="calc-input">
          </div>
          <div class="calc-field">
            <label class="muted">Hasta</label>
            <input type="date" id="historicalEndDate" class="calc-input">
          </div>
          <button id="historicalUpdate" class="btn">Ver</button>
        </div>

        <div id="historicalTableContainer" style="margin-top: 16px;"></div>
        <div id="historicalError" class="muted" style="color:hsl(0 100% 40%); text-align:center; margin-top: 8px;">
        </div>
      </div>
    </div>

    <div id="toast" class="toast">¬°Copiado!</div>
    <div id="loading" class="loading" style="position: fixed; top: 22px; right: 26px; z-index: 101;"></div>
  </div>
  <script type="module" src="popup.js"></script>
</body>

</html>